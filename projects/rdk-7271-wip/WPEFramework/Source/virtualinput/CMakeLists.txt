project(virtualinput)

include(setup_target_properties_library)
include(show_target_properties)

message("Setting up virtualinput")

set(WPEFRAMEWORK_VIRTUALINPUT_DEFINITIONS
    CACHE INTERNAL "${PROJECT_NAME}: Definitions" FORCE)

set(WPEFRAMEWORK_VIRTUALINPUT_INCLUDE
    CACHE INTERNAL "${PROJECT_NAME}: Include Directories" FORCE)

set(WPEFRAMEWORK_VIRTUALINPUT_LIBS
    ${CMAKE_THREAD_LIBS_INIT}
    ${CMAKE_DL_LIBS}
    WPEFrameworkCore)

set(VIRTUALKEYBOARD_HEADERS_DIR "WPEFramework/virtualkeyboard")
set(VIRTUALKEYBOARD_LIB_NAME WPEFrameworkVirtualInput)

file(GLOB WPEFRAMEWORK_VIRTUALINPUT_INCLUDES *.h)
file(GLOB WPEFRAMEWORK_VIRTUALINPUT_SOURCES *.cpp)

if(INSTALL_HEADERS_TO_TARGET)
    install(FILES ${WPEFRAMEWORK_VIRTUALINPUT_INCLUDES} DESTINATION ${CMAKE_INSTALL_PREFIX}/include/${VIRTUALKEYBOARD_HEADERS_DIR})
else()
    foreach(path ${CMAKE_FIND_ROOT_PATH})
        file(COPY ${WPEFRAMEWORK_VIRTUALINPUT_INCLUDES} DESTINATION ${path}/usr/include/${VIRTUALKEYBOARD_HEADERS_DIR})
    endforeach()
endif()

set(WPEFRAMEWORK_VIRTUALINPUT_INPUT
    ${WPEFRAMEWORK_VIRTUALINPUT_SOURCES}
    ${WPEFRAMEWORK_VIRTUALINPUT_INCLUDES}
    CACHE INTERNAL "${PROJECT_NAME}: Source files" FORCE)

configure_file(
        "${CMAKE_CURRENT_SOURCE_DIR}/virtualkeyboard.pc.in"
        "${CMAKE_BINARY_DIR}/virtualkeyboard.pc"
        @ONLY)

add_library(${VIRTUALKEYBOARD_LIB_NAME} ${WPEFRAMEWORK_VIRTUALINPUT_INPUT})
target_compile_definitions(${VIRTUALKEYBOARD_LIB_NAME} PRIVATE ${WPEFRAMEWORK_VIRTUALINPUT_DEFINITIONS})
target_include_directories(${VIRTUALKEYBOARD_LIB_NAME} PRIVATE ${WPEFRAMEWORK_VIRTUALINPUT_INCLUDE})
target_link_libraries(${VIRTUALKEYBOARD_LIB_NAME} ${WPEFRAMEWORK_VIRTUALINPUT_LIBS})
set_target_properties(${VIRTUALKEYBOARD_LIB_NAME} PROPERTIES DEFINE_SYMBOL WPEFRAMEWORK_VIRTUALINPUT)
set_target_properties(${VIRTUALKEYBOARD_LIB_NAME} PROPERTIES SOVERSION ${WPEFRAMEWORK_VERSION})

setup_target_properties_library(${VIRTUALKEYBOARD_LIB_NAME})

#show_target_properties(${PROJECT_NAME})

install(TARGETS ${VIRTUALKEYBOARD_LIB_NAME} DESTINATION ${CMAKE_INSTALL_PREFIX}/lib)
install(FILES ${CMAKE_BINARY_DIR}/virtualkeyboard.pc DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/pkgconfig")
