set(PLUGIN_NAME RemoteControl)

include(module) # Setup default stuff needed for the cmake framework thingy.

set(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_KEYMAP "keymap.json" CACHE STRING "Default keymap")
set(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP "NexusIR.json" CACHE STRING "Nexus IR keymap")

find_package(BcmNxServer QUIET)
find_package(VirtualInput QUIET)
find_package(RF4CE QUIET)

set(PLUGIN_DEFINITIONS)

set(PLUGIN_SOURCES
	Module.cpp
	RemoteControl.cpp
	RemoteAdministrator.cpp
)

if(LIBVIRTUALINPUT_FOUND)
	list(APPEND PLUGIN_DEFINITIONS VIRTUAL_INPUT_ENABLED)
endif()

if (WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT)
	list(APPEND PLUGIN_DEPENDENCIES udev)
	list(APPEND PLUGIN_SOURCES LinuxDevice.cpp)
endif()

if(LIBNXSERVER_FOUND)
	if (WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS)
		list(APPEND PLUGIN_DEPENDENCIES_INCLUDE_DIRS ${LIBNXCLIENT_INCLUDE_DIRS})
		list(APPEND PLUGIN_DEPENDENCIES ${LIBNEXUS_LIBRARY} ${LIBNXCLIENT_LIBRARY})
		list(APPEND PLUGIN_SOURCES IRRemote.cpp)
		list(APPEND PLUGIN_DEFINITIONS IR_ENABLED)
		if(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_HOST)
			set(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP "${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_HOST}-IRRemoteKeyMap-${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRMODE}.json")
		else(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_HOST)
			set(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP "IRRemoteKeyMap-${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRMODE}.json")
		endif(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_HOST)
		if(NOT EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP}")
			set(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP "IRRemoteKeyMap-${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRMODE}.json")
		endif()
	endif(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS)
endif()

if(RF4CE_FOUND)
    message(" - Including RF4CE support")

    include_directories (${RF4CE_INCLUDE_DIRS})

    set (PLUGIN_REMOTECONTROL_RF ON)

    list(APPEND PLUGIN_LIBS ${RF4CE_LIBRARIES})
    list(APPEND PLUGIN_DEPENDENCIES ${RF4CE_LIBRARIES})
    list(APPEND PLUGIN_SOURCES GreenPeak.cpp)
    list(APPEND PLUGIN_DEFINITIONS
      -DGP_CHANGELIST=70269
      -DGP_COMPONENT_ID_APP=1
      -DGP_COMPONENT_ID_ASSERT=29
      -DGP_COMPONENT_ID_BASECOMPS=35
      -DGP_COMPONENT_ID_BSP=8
      -DGP_COMPONENT_ID_ENCRYPTION=124
      -DGP_COMPONENT_ID_FA=26
      -DGP_COMPONENT_ID_GPHAL=7
      -DGP_COMPONENT_ID_HALLINUX=6
      -DGP_COMPONENT_ID_LOG=11
      -DGP_COMPONENT_ID_MACCORE=109
      -DGP_COMPONENT_ID_MACDISPATCHER=114
      -DGP_COMPONENT_ID_NVM=32
      -DGP_COMPONENT_ID_PAD=126
      -DGP_COMPONENT_ID_PD=104
      -DGP_COMPONENT_ID_POOLMEM=106
      -DGP_COMPONENT_ID_RANDOM=108
      -DGP_COMPONENT_ID_RESET=33
      -DGP_COMPONENT_ID_RF4CE=25
      -DGP_COMPONENT_ID_RF4CEBINDAUTO=45
      -DGP_COMPONENT_ID_RF4CEDISPATCHER=40
      -DGP_COMPONENT_ID_RF4CEUSERCONTROL=41
      -DGP_COMPONENT_ID_RXARBITER=2
      -DGP_COMPONENT_ID_SCHED=9
      -DGP_COMPONENT_ID_STAT=22
      -DGP_COMPONENT_ID_UTILS=4
      -DGP_COMPONENT_ID_VERSION=129
      -DGP_COMPONENT_ID_WMRK=51
      -DGP_COMP_GPHAL_ES_ABS_EVENT
      -DGP_COMP_GPHAL_ES_REL_EVENT
      -DGP_DIVERSITY_GPHAL_EXTERN
      -DGP_DIVERSITY_NR_OF_STACKS=1
      -DGP_HAL_ES_NUMBER_OF_ABS_EVENT_RX_ARBITER=2
      -DGP_MACCORE_DIVERSITY_SCAN_ACTIVE_ORIGINATOR
      -DGP_MACCORE_DIVERSITY_SCAN_ACTIVE_RECIPIENT
      -DGP_MACCORE_DIVERSITY_SCAN_ED_ORIGINATOR
      -DGP_MACCORE_DIVERSITY_SCAN_ORIGINATOR
      -DGP_MACCORE_DIVERSITY_SCAN_ORPHAN_ORIGINATOR
      -DGP_MACCORE_DIVERSITY_SCAN_ORPHAN_RECIPIENT
      -DGP_MACCORE_DIVERSITY_SCAN_RECIPIENT
      -DGP_NVM_NBR_OF_SECTIONS=4
      -DGP_POOLMEM_CHUNK_AMOUNT1=4
      -DGP_POOLMEM_CHUNK_AMOUNT2=5
      -DGP_POOLMEM_CHUNK_AMOUNT3=5
      -DGP_POOLMEM_CHUNK_SIZE1=30
      -DGP_POOLMEM_CHUNK_SIZE2=50
      -DGP_POOLMEM_CHUNK_SIZE3=100
      -DGP_RF4CE_BIND_AUTO_USER_STRING=UPC_Horizon
      -DGP_RF4CE_DIVERSITY_AUTO_DISCOVERY
      -DGP_RF4CE_MAX_DISCOVERY_PROFILEID_LIST_SIZE=7
      -DGP_RF4CE_MAX_NODE_DESCRIPTOR_LIST_SIZE=16
      -DGP_RF4CE_NWKC_MAX_PAIRING_TABLE_ENTRIES=6
      -DGP_RF4CE_NWKC_VENDOR_IDENTIFIER=0x0003
      -DGP_RF4CE_NWKC_VENDOR_STRING=SUMSUG
      -DGP_RF4CE_USER_CONTROL_IND_MAX_PENDING_KEYS=1
      -DGP_RF4CE_USER_CONTROL_PROFILE_ID_LIST=gpRf4ce_ProfileIdZrc
      -DGP_RF4CE_USER_CONTROL_REQ_MAX_PENDING_KEYS=0
      -DGP_SCHED_DEFAULT_GOTOSLEEP_THRES=1
      -DGP_SCHED_EVENT_LIST_SIZE=30
      -DGP_SCHED_FREE_CPU_TIME=5000
      -DGP_VERSIONINFO_APP=RemoteControl
      -DGP_VERSIONINFO_BASE_COMPS=2,4,5,2
      -DGP_VERSIONINFO_CONFIG=/
      -DGP_VERSIONINFO_DATE=2015-09-11
      -DGP_VERSIONINFO_GLOBAL_VERSION=2,4,5,2
      -DGP_VERSIONINFO_HOST=UNKNOWN
      -DGP_VERSIONINFO_PROJECT=METROLOGICAL
      -DGP_VERSIONINFO_RACE_VERSION=1,3,2,1
      -DGP_VERSIONINFO_USER=UNKNOWN@UNKNOWN
      -DMAIN_FUNCTION_NAME=gpMain
    )
endif()

if (WPEFRAMEWORK_VERBOSE_BUILD)
    display_list("Defines                     : " ${PLUGIN_DEFINITIONS} )
    display_list("Compiler options            : " ${PLUGIN_OPTIONS} )
    display_list("Source files                : " ${PLUGIN_SOURCES} )
    display_list("Include files               : " ${PLUGIN_INCLUDES} )
    display_list("Include dirs                : " ${PLUGIN_INCLUDE_DIRS} )
    display_list("Link libs                   : " ${PLUGIN_LIBS} )
    display_list("Linker options              : " ${PLUGIN_LINK_OPTIONS} )
    display_list("Dependencies                : " ${PLUGIN_DEPENDENCIES} )
endif()


set(PLUGIN_INPUT
	${PLUGIN_SOURCES}
	${PLUGIN_INCLUDES})

include(default_targets) # This is a regular plugin no need to edit the defaults

if (WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS AND WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP AND EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP}" AND NOT IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP}")
	message("Nexus IR device key map file: " ${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP})
	install(FILES KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP} DESTINATION ${CMAKE_INSTALL_PREFIX}/share/WPEFramework/RemoteControl)
endif()

if (WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT AND WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT_KEYMAP AND EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT_KEYMAP}" AND NOT IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT_KEYMAP}")
	message("LinuxDevice device key map file: " ${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT_KEYMAP})
	install(FILES KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT_KEYMAP} DESTINATION ${CMAKE_INSTALL_PREFIX}/share/WPEFramework/RemoteControl)
endif()

if(EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_KEYMAP}" AND NOT IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_KEYMAP}")
	message("Use keymap file: " ${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_KEYMAP})
	install(
		FILES KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_KEYMAP}
		DESTINATION ${CMAKE_INSTALL_PREFIX}/share/WPEFramework/RemoteControl)
else()
	set(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_KEYMAP "keymap.json")
	install(
		FILES KeyMaps/keymap.json
		DESTINATION ${CMAKE_INSTALL_PREFIX}/share/WPEFramework/RemoteControl
		COMPONENT ${MODULE_NAME})
endif()

write_config(${PLUGIN_NAME})
